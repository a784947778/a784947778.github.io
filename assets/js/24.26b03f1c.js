(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{301:function(a,e,t){"use strict";t.r(e);var s=t(13),r=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"jenkins-docker-实现一键自动化部署项目-步骤齐全-少走坑路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-docker-实现一键自动化部署项目-步骤齐全-少走坑路"}},[a._v("#")]),a._v(" Jenkins+Docker 实现一键自动化部署项目！步骤齐全，少走坑路！")]),a._v(" "),e("p",[e("strong",[a._v("环境")]),a._v("：centos7+git(gitee)")]),a._v(" "),e("p",[a._v("简述实现步骤：在docker安装jenkins，配置jenkins基本信息，利用Dockerfile和shell脚本实现项目自动拉取打包并运行。")]),a._v(" "),e("h2",{attrs:{id:"安装docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[a._v("#")]),a._v(" 安装docker")]),a._v(" "),e("p",[a._v("docker 安装社区版本CE")]),a._v(" "),e("ul",[e("li",[a._v("确保 yum 包更新到最新。")])]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("yum update\n")])])]),e("ul",[e("li",[a._v("卸载旧版本(如果安装过旧版本的话)")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("yum remove docker  docker-common docker-selinux docker-engine\n")])])]),e("ul",[e("li",[a._v("安装需要的软件包")])]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" yum-utils device-mapper-persistent-data lvm2\n")])])]),e("ul",[e("li",[a._v("设置yum源")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n")])])]),e("ul",[e("li",[a._v("安装docker")])]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker-ce  "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#由于repo中默认只开启stable仓库，故这里安装的是最新稳定版17.12.0")]),a._v("\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("自己的版本"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 例如：sudo yum install docker-ce-17.12.0.ce")]),a._v("\n")])])]),e("ul",[e("li",[a._v("启动和开机启动")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("# 启动docker\nsystemctl start docker\n# 停止docker\nsystemctl stop docker\n# 重启docker\nsystemctl restart docker\n# 查看docker状态\nsystemctl status docker\n# 开机启动\nsystemctl enable docker\n# 查看docker概要信息\ndocker info\n# 查看docker总体帮助文档\ndocker --help\n# 查看docker命令帮助文档\ndocker 具体命令 --help\n# 验证安装是否成功\ndocker version\n")])])]),e("h2",{attrs:{id:"安装jenkins"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装jenkins"}},[a._v("#")]),a._v(" 安装Jenkins")]),a._v(" "),e("p",[a._v("Jenkins中文官网：https://www.jenkins.io/zh/")]),a._v(" "),e("ul",[e("li",[a._v("安装J enkins")])]),a._v(" "),e("p",[a._v("docker 安装一切都是那么简单，注意检查8080是否已经占用！如果占用修改端口")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" jenkins "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":8080 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("50000")]),a._v(":50000 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /var/jenkins_home:/var/jenkins_home "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /var/run/docker.sock:/var/run/docker.sock jenkinsci/blueocean\n")])])]),e("p",[a._v("如果没改端口号的话")]),a._v(" "),e("p",[a._v("安装完成后访问地址-> "),e("code",[a._v("http://{部署Jenkins所在服务IP}:8080")])]),a._v(" "),e("p",[a._v("此处会有几分钟的等待时间。")]),a._v(" "),e("ul",[e("li",[a._v("初始化 Jenkins")])]),a._v(" "),e("p",[a._v("详情见官网教程->"),e("code",[a._v("https://www.jenkins.io")])]),a._v(" "),e("ul",[e("li",[a._v("解锁 Jenkins")])]),a._v(" "),e("p",[a._v("进入Jenkins容器："),e("code",[a._v("docker exec -it {Jenkins容器名} bash")])]),a._v(" "),e("p",[a._v("例如 "),e("code",[a._v("docker exec -it jenkins bash")])]),a._v(" "),e("p",[a._v("查看密码："),e("code",[a._v("cat /var/lib/jenkins/secrets/initialAdminPassword")])]),a._v(" "),e("p",[a._v("复制密码到输入框里面")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPrbEhqbcLR8wXrg2KAhUuILPY6o7qC22AdrchC2O5kpkHSy62jv9chA/640?wx_fmt=png&random=0.2761577485869935&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("ul",[e("li",[a._v("安装插件")])]),a._v(" "),e("p",[a._v("选择第一个：安装推荐的插件")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPMShC9B9Gb1uaG4wa1HiaEGaoKYKa3IsH63icts1LdKAOwokfbCbkn0hA/640?wx_fmt=png&random=0.24174694738504887&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("ul",[e("li",[a._v("创建管理员用户")])]),a._v(" "),e("p",[a._v("此账户一定要记住哦")]),a._v(" "),e("h2",{attrs:{id:"系统配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#系统配置"}},[a._v("#")]),a._v(" 系统配置")]),a._v(" "),e("ul",[e("li",[a._v("安装需要插件")])]),a._v(" "),e("p",[a._v("进入【"),e("code",[a._v("首页")]),a._v("】–【"),e("code",[a._v("系统管理")]),a._v("】–【"),e("code",[a._v("插件管理")]),a._v("】–【"),e("code",[a._v("可选插件")]),a._v("】")]),a._v(" "),e("p",[a._v("搜索以下需要安装的插件，点击安装即可。")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPQDKicJDxKMYtmb2MR4zTsibv5nNPOQbXMaK7fF7RuxaeumlDclmjKqbA/640?wx_fmt=png&random=0.0851113119142719&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("ul",[e("li",[a._v("安装Maven Integration")]),a._v(" "),e("li",[a._v("安装Publish Over SSH(如果不需要远程推送，不用安装)")]),a._v(" "),e("li",[a._v("如果使用Gitee 码云，安装插件Gitee（Git自带不用安装）")]),a._v(" "),e("li",[a._v("配置Maven")])]),a._v(" "),e("p",[a._v("进入【"),e("code",[a._v("首页")]),a._v("】–【"),e("code",[a._v("系统管理")]),a._v("】–【"),e("code",[a._v("全局配置")]),a._v("】，拉到最下面maven–maven安装")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPia49FfDyicLsL2PFLPF3pLjHRADicwTQXoia7GEA0r5kwCleEFvIgmicmGA/640?wx_fmt=png&random=0.2950981127239827&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("h2",{attrs:{id:"创建任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建任务"}},[a._v("#")]),a._v(" 创建任务")]),a._v(" "),e("ul",[e("li",[a._v("新建任务")])]),a._v(" "),e("p",[a._v("点击【"),e("code",[a._v("新建任务")]),a._v("】，输入任务名称，点击构建一个自由风格的软件项目")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPn4pxtrwxiaVpNPCXVzzxibKnMn4hvt3j7grKIKsvwtu2cgia5f9od5jSQ/640?wx_fmt=png&random=0.5713521000113295&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("ul",[e("li",[a._v("源码管理")])]),a._v(" "),e("p",[a._v("点击【"),e("code",[a._v("源码管理")]),a._v("】–【"),e("code",[a._v("Git")]),a._v("】，输入仓库地址，添加凭证，选择好凭证即可。")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPOMibyibMl1EhH9Aib2s2lcywNibN4q4kaer2lW755YUFEaUxXpm3saC2CQ/640?wx_fmt=png&random=0.7040381943590521&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}}),e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPoC0a8j24GtrU1kDfBCoxLbLHzOxCPF8CLOKmvKF1SiannerYcTtMSOA/640?wx_fmt=png&random=0.3578799357090834&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("ul",[e("li",[a._v("构建触发器")])]),a._v(" "),e("p",[a._v("点击【"),e("code",[a._v("构建触发器")]),a._v("】–【"),e("code",[a._v("构建")]),a._v("】–【"),e("code",[a._v("增加构建步骤")]),a._v("】–【"),e("code",[a._v("调用顶层Maven目标")]),a._v("】–【"),e("code",[a._v("填写配置")]),a._v("】–【"),e("code",[a._v("保存")]),a._v("】")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPFRPpniaN1AeLVaj1ia4C6a4iaBHHqF9psdXibQQRDWFda8o0qO8aXy998g/640?wx_fmt=png&random=0.15483698622630326&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("p",[a._v("此处命令只是install，看是否能生成jar包")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("clean install -Dmaven.test.skip=true\n")])])]),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPcuVDibxKIgToKm3kINsEibqtibnDU7dV2hEryTTUiaIMPSqYUjFY0h4tKw/640?wx_fmt=png&random=0.39540935727714044&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("ul",[e("li",[a._v("保存")])]),a._v(" "),e("p",[a._v("点击【"),e("code",[a._v("保存")]),a._v("】按钮即可")]),a._v(" "),e("h2",{attrs:{id:"测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),e("p",[a._v("该功能测试是否能正常打包")]),a._v(" "),e("ul",[e("li",[a._v("构建")])]),a._v(" "),e("p",[a._v("点击构建按钮"),e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPO0oSgB0Hm2x6P31EGU7UY1USSMhyj3icwibofRLnNoBE2M2ze36Damtw/640?wx_fmt=png&random=0.6333519074716008&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("ul",[e("li",[a._v("查看日志")])]),a._v(" "),e("p",[a._v("点击正在构建的任务，或者点击任务名称，进入详情页面，查看控制台输出，看是否能成功打成jar包。")]),a._v(" "),e("p",[a._v("该处日志第一次可能下载依赖jar包失败，再次点击构建即可成功。")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPwWo4BwS4wjnVxb3dE2gXttNz7oHCwaegprnwvibPUmOmjN1ibt7zJxCA/640?wx_fmt=png&random=0.5999876700852618&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}}),e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPR7ZIgzsXNFukU8lU5v22NCxlsE8s6RkgQ2qiaScpSicKiboUe8gJAjF1A/640?wx_fmt=png&random=0.7780396922427533&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("ul",[e("li",[a._v("查看项目位置")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("cd /var/jenkins_home/workspace\n")])])]),e("p",[e("code",[a._v("ll")]),a._v("命令即可查看是否存在")]),a._v(" "),e("h2",{attrs:{id:"运行项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运行项目"}},[a._v("#")]),a._v(" 运行项目")]),a._v(" "),e("p",[a._v("因为我们项目和jenkins在同一台服务器，所以我们用shell脚本运行项目，原理既是通过dockerfile 打包镜像，然后docker运行即可。")]),a._v(" "),e("ul",[e("li",[a._v("Dockerfile")])]),a._v(" "),e("p",[a._v("在springboot项目根目录新建一个名为Dockerfile的文件，注意没有后缀名，其内容如下:（大致就是使用jdk8，把jar包添加到docker然后运行prd配置文件）")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('FROM jdk:8\nVOLUME /tmp\nADD target/zx-order-0.0.1-SNAPSHOT.jar app.jar\nEXPOSE 8888\nENTRYPOINT ["Bash","-DBash.security.egd=file:/dev/./urandom","-jar","/app.jar","--spring.profiles.active=prd"]\n')])])]),e("ul",[e("li",[a._v("修改jenkins任务配置")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPodf2UHianoee3djfCv0SHTyxiaen9CFgOLic89EIXQlDStJqUg20Jd7Lg/640?wx_fmt=png&random=0.8426236552246651&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("p",[a._v("配置如下：")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACPTIevYoH9CEPPicianP33fnFmMWkxHMVZiaRbVSA7esFlQmXb4Hh4x0s5w/640?wx_fmt=png&random=0.917211172327181&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("-t：指定新镜像名\n.：表示Dockfile在当前路径\ncd /var/jenkins_home/workspace/zx-order-api\ndocker stop zx-order || true\ndocker rm zx-order || true\ndocker rmi zx-order || true\ndocker build -t zx-order .\ndocker run -d -p 8888:8888 --name zx-order zx-order:latest\n")])])]),e("p",[a._v("备注：")]),a._v(" "),e("ul",[e("li",[a._v("我上图用了docker logs -f 是为了方便看日志，真实不要用，因为会一直等待日志，构建任务会失败")]),a._v(" "),e("li",[a._v("加|| true 是如果命令执行失败也会继续实行，为了防止第一次没有该镜像报错")]),a._v(" "),e("li",[a._v("保存")])]),a._v(" "),e("p",[a._v("点击保存即可")]),a._v(" "),e("ul",[e("li",[a._v("构建")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/NW4iaKVI4GNNLwxG4hXR3cy7wI4AzdACP1O6qdkh7ibB11ql6qmX8CSibk74qKdzW0AzuPYXORYtiaeot3uRwUMBPQ/640?wx_fmt=png&random=0.7267159854280252&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),a._v(" "),e("p",[a._v("查看jenkins控制台输出，输出如下，证明成功！")]),a._v(" "),e("ul",[e("li",[a._v("验证")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("docker ps 查看是否有自己的容器\ndocker logs 自己的容器名 查看日志是否正确\n")])])]),e("p",[a._v("浏览器访问项目试一试")]),a._v(" "),e("p",[e("strong",[a._v("· END ·")])]),a._v(" "),e("p",[a._v("RabbitMq")]),a._v(" "),e("p",[a._v("在docker下部署RabbitMq容器，启动成功以后，需要进入RabbitMq容器中配置下面指令，否则客服端不能成功的访问")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("rabbitmq-plugins "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" rabbitmq_management rabbitmq_web_stomp rabbitmq_stomp rabbitmq_web_stomp_examples\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);